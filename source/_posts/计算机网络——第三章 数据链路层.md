---
title: 计算机网络——第三章 数据链路层
tag: 计算机网络
date: 2018-05-19

---

<meta name="referrer" content="no-referrer" />



# 计算机网络——第三章 数据链路层

## 使用点对点信道的数据链路层
**链路**：从一个结点到相邻结点的一段物理路线，路径组成的一部分
**数据链路**：除了物理线路，还包括一些通信协议，如网络适配器

*当数据通信中采用复用技术时，一条链路上可以有多条数据链路*

- 主要功能
1、链路管理：数据链路连接的建立、维持和释放的操作
2、寻址：必须保证每一帧都能送到正确的地址，接收方要能够知道谁是发送方（MAC地址及转发表）
3、流量控制：控制相邻两个节点之间数据链路上的流量（如停等协议、ARQ协议、滑动窗口协议等）
4、帧同步：准确地区分帧的起始与终止（帧标志）
5、透明传输：在数据链路层中，对所传输的数据无论它们是由什么样的比特组合起来的，在数据链路上都应该能够传输，如：零比特插入法（5个连1插1个0）
6、差错控制：如错误帧或帧丢失，常用的差错控制方法有检错重发（自动请求重发ARQ）、前向纠错FEC、反馈检验法

- 主要步骤
（1）将网络层的IP数据报添加首部和尾部封装成帧
（2）将封装好的帧发送给相邻的数据链路层
（3）接收导的帧无差错，提取IP数据报上交给网络层

#### 三个基本问题
- 封装成帧：在一段数据的前后分别加上首部和尾部
最大传输单元MTU：帧的数据部分长度上限
控制字符SOH：帧的首部开始
控制字符EOT：帧的尾部结束

- 透明传输：数据链路层对数据是透明的
转义字符ESC：使控制字符SOH、EOT不被解释为控制字符，发送端插入改字符，接收端删除该字符，这就是字节填充、字符填充![](https://upload-images.jianshu.io/upload_images/4061843-4483f0c63728cdd0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


- 差错检测：
比特差错：0变1，1变0
误码率BER：同一时间内，传输错误的比特占传输比特总数的比率
循环冗余检验CRC技术
帧检验序列FCS 
![](https://upload-images.jianshu.io/upload_images/4061843-64f372af47810eba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![未命名.jpg](https://upload-images.jianshu.io/upload_images/4061843-029ad30c9f6fd202.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### 常见数据链路层协议
![](https://upload-images.jianshu.io/upload_images/4061843-51679fc1495d1fca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

---
---

## 点对点协议PPP
用户计算机和ISP进行通信时所使用的数据链路层协议

- **三个核心组成部分：**
1、上传用户数据（IP数据报等）封装方法
2、LCP链路控制协议
3、NCP网络控制协议

- PPP的组成
（1）一个将IP数据报封装到串行链路的方法，IP数据报在PPP帧中就是信息部分，长度受到MTU限制
（2）一个用来建立、配置和测试数据链路连接的链路控制协议LCP
（3）一套网络控制协议NCP

#### 帧格式

- 字段的意义
![](https://upload-images.jianshu.io/upload_images/4061843-d2fcc0799f69d6cb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)![](https://upload-images.jianshu.io/upload_images/4061843-818747c8379afd18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

F：标志字段，规定为0x7E，表示帧的开始和结束
A：地址字段，规定位0xFF
C：控制字段，规定为0x03
协议：2字节，字段为0x0021时，PPP帧的信息部分为IP数据报，若为0xC021，信息字段是LCP的数据，若为0x8021，信息字段是网络层的控制数据
FCS：使用CRC的帧检验序列

- 字节填充
当信息字段中出现和标志字段一样的比特（0x7E）组合时，需要转义
异步传输时，定义转义字符位0x7D，使用字节填充
（1）把信息字段中出现的每一个0x7E字节转变成2字节序列(0x7D, 0x5E)
（2）若信息字段中出现一个0x7D的字节，则把0x7D转变成2字节序列(0x7D, 0x5D)
（3）若字段出现ASCII码的控制字符，则在字符前加入一个0x7D字节，同时将字符的编码改变
接收端进行相反的变换

- 零比特填充
在SONET/SDH链路时，同步传输

#### 工作状态
![未命名.jpg](https://upload-images.jianshu.io/upload_images/4061843-66eb896f6657eb9b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

1、当拨号接入ISP后，对拨号确认，建立物理连接
2、用户个人电脑向ISP发送一些列的链路控制协议LCP分组（封装成多个PPP帧），这些分组及其响应选择了将要使用的一些PPP参数来配置数据链路
3、LCP配置完成后，进入认证阶段（也可以不认证）
4、网络层协商阶段，NCP给新接入的用户分配IP地址。
5、通信完毕后，NCP释放网络层连接，收回IP地址，LCP释放数据链路层连接，最后释放物理层连接。

LCP配置请求帧（Configure-Request）：
（1）配置确认帧（Configure-Ack）
（2）配置否认帧（Configure-Nak）
（3）配置拒绝帧（Configure-Reject）

鉴别：
（1）口令鉴别协议PAP：明文
（2）口令握手鉴别协议CHAP：密文

PPP链路上若运行IP协议，NCP就要使用IP控制协议IPCP（字段：0x8021）

网络配置完毕后，进入Link Open，两个PPP端点还可发送回送请求LCP分组（Echo-Request）和回送回答LCP分组（Echo-Reply）

数据传输结束后，链路一端发送终止请求LCP分组（Terminate-Request）请求终止，在收到对方发来的确认LCP分组（Terminate-Ack）后，链路终止

---
---

## PPPoE协议

- 发现阶段：x8863
（1）PADI（广播）：用户计算机发起初始化广播报文
（2）PADO（单播）：访问集中器回应各用户主机发送的PADI报文
（3）PADR（单播）：用户向服务器发送单播的请求报文
（4）PADS（单播）：访问集中器为会话分配唯一的会话ID
（5）PADT：强制结束会话

- 点对点会话阶段：x8864，PPP协议完成
（1）LCP
（2）PAP
（3）NCP
（4）PADT：强制终止PPPoE会话

![](https://upload-images.jianshu.io/upload_images/4061843-5d4f798b71cdd0a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

---
---

## 使用广播信道的数据链路层

#### 局域网的数据链路层
主要特点：网络为一个单位所有，地理范围和站点数目有限
优点：
（1）广播功能，从一个站点方便全网，局域网上的主机可共享连接在网上的硬件和软件资源
（2）便于系统的扩展和逐渐演变，设备位置可灵活调整
（3）提高系统的可靠性、可用性、生存性

- 网路拓扑分类：星型网、环形网、总线网

- 共享信道的方法
（1）静态划分信道：频分复用、时分复用、波分复用、码分复用
（2）动态媒体接入控制：多点接入，信道并非用户通信时固定分配给用户
随机接入：随机发送信息，会产生碰撞导致信息发送失败
受控接入：用户不能随机发送信息，必须服从一定的控制，如多点线路探询、论询

- 以太网的两个标准
（1）标准DIX Ethernet V2 
（2）标准IEEE 802.3[W-IEEE802.3]
> IEEE 802
> 802.1——桥接/体系结构
> 802.3——以太网
> 802.11——无线局域网
> 802.15——无线个人区域网
> 802.16——宽带无线接入
> 802.19——无线共存
> 802.21——媒体无关切换
> 802.22——无线偏远地区网络

局域网的数据两路层分为逻辑链路控制LLC（Logical Link Control）子层和媒体接入控制MAC（Medium Access Control）子层

- 适配器

#### CSMA/CD 协议（半双工通信）
载波监听多点接入/碰撞检测

- 多点接入：总线型网络
- 载波监听：用电子技术检测总线上有没有其他计算机也在发送，检测信道
- 碰撞检测：边发送边监听
> 电磁波在1km电缆的传播时延约为5us，争用期时间为单次传播的两倍（往返）为51.2us，512比特时间

#### 使用集线器的星型拓扑
（1）仍然是一个总线网
（2）有许多接口，像一个多接口的转发器
（3）工作在物理层，仅仅简单转发比特
（4）专门的芯片，进行自适应串音回波抵消

#### 以太网的信道利用率

a=单程端到端时延/帧的发送时间
极限信道利用率=1 /（1-+a）

#### 以太网的MAC层

- MAC层的硬件地址：MAC地址，物理地址，IEEE 802规定48位（6个字节）的地址（固化在适配器的ROM中的地址）
OUI：组织唯一标识符，前3个字节，又叫公司标识符
扩展标识符：后3个字节
IEEE规定地址字段的第一个字节最低位为I/G位，I/G为0时表示单个地址，为1时表示组地址（进行多播）

- MAC帧的格式

![未命名.jpg](https://upload-images.jianshu.io/upload_images/4061843-c5cd5943b01acc74.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
类型：标志上一层使用了什么协议
数据：IP数据报
FCS：帧检验序列（CRC检验）
插入的8字节：
（1）前7个字节的前同步码，使接收端的适配器在接收MAC帧时调整时钟频率，使同步
（2）帧开始定界符，为10101011

数据长度小于46字节时会自动加入填充字段，以保证每个帧长不少于64字节
无效帧：
（1）长度不是整数个字节
（2）FCS检测有错
（3）数据长度不在46～1500字节之间，MAC首尾有18个，真正有效长度64～1518

---
---

## 扩展以太网

- 物理层扩展
光纤调制解调器：进行电信号和光信号的转换

- 数据链路层扩展
**以太网交换机**：
特点：多接口的网桥，全双工方式，具有并行性，无碰撞传输
自学习能力：自学之前广播发出，学习有了MAC地址后不再广播
总线以太网到星型以太网

- 虚拟局域网
VLAN划分

#### VLAN
虚拟局域网，是一种通过将局域网内的设备逻辑地而不是物理地划分成一个个网段从而实现虚拟工作组的技术。 

划分Vlan的主要作用是隔离广播域。
**两种方法：**
![](https://upload-images.jianshu.io/upload_images/4061843-046bedcd99d828e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![](https://upload-images.jianshu.io/upload_images/4061843-2d41b3494d676689.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- **VLAN的划分方法：**
1. 基于端口的VLAN：![](https://upload-images.jianshu.io/upload_images/4061843-704a855e646f2dc0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
2. 基于MAC地址的VLAN：![](https://upload-images.jianshu.io/upload_images/4061843-c81b7d97ff30a6aa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
3. 基于协议的VLAN：![](https://upload-images.jianshu.io/upload_images/4061843-112abcf0cb43d05d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
4. 基于子网的VLAN：![](https://upload-images.jianshu.io/upload_images/4061843-76bad03b9816fe0d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- **VLAN工作原理：**
1、![](https://upload-images.jianshu.io/upload_images/4061843-b85066ee690950cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
2、![](https://upload-images.jianshu.io/upload_images/4061843-d9a31f8e75881381.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
**报文类型：**![](https://upload-images.jianshu.io/upload_images/4061843-674dff39b4885b4b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
**端口类型：**![](https://upload-images.jianshu.io/upload_images/4061843-6f4b2a2c746cf7cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![](https://upload-images.jianshu.io/upload_images/4061843-538e6fcbebdce1ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- **标准：**
![](https://upload-images.jianshu.io/upload_images/4061843-9bc609901fa1851b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

---
---

## 高速以太网
- 100BASE-T：100Mbit/s，星型拓扑，快速以太网
- 基比特以太网：1Gbit/s下全双工或半双工工作，使用IEEE 802.3协议的帧格式，只在半双工下使用CSMA/CD协议，与10BASE-T和100BASE-T技术向后兼容
- 10吉比特以太网和更快的以太网：10GE只在全双工方式
- 以太网宽带接入